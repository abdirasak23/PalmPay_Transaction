<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>PalmPay · white & grey</title>
<!-- Google Fonts & Font Awesome (icons) -->
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#f5f7fa;               /* light grey background */
  --phone-bg:#ffffff;          /* white phone body */
  --surface:#f0f2f5;           /* soft grey */
  --surface2:#e6e9ef;          /* medium grey */
  --border:rgba(0,0,0,0.06);
  --cyan:#00E5FF;              /* kept minimal, can be neutral */
  --cyan-dim:rgba(0,0,0,0.02);
  --green:#10b981;             /* adjusted to softer grey-green */
  --red:#f43f5e;
  --text:#1e1e2f;              /* dark grey for text */
  --muted:#7e8493;             /* muted grey */
  --white:#ffffff;
  --grey-light:#f8fafc;
}
html,body{height:100%;background:var(--bg);font-family:'IBM Plex Mono',monospace;display:flex;align-items:center;justify-content:center;overflow:hidden}

body::before{
  content:'';position:fixed;inset:0;
  background:radial-gradient(ellipse 60% 60% at 50% 50%, rgba(0,0,0,0.02), transparent);
  pointer-events:none;
}

/* ── Phone shell – white/grey minimal ── */
.phone{
  width:375px;height:812px;
  background:var(--phone-bg);
  border-radius:54px;
  border:2px solid rgba(0,0,0,0.04);
  box-shadow:
    0 0 0 8px #edf2f7,
    0 0 0 10px rgba(0,0,0,0.02),
    0 40px 100px rgba(0,0,0,0.12),
    0 0 60px rgba(0,0,0,0.02);
  position:relative;
  overflow:hidden;
  display:flex;flex-direction:column;
}

/* notch – light grey */
.notch{
  width:126px;height:34px;
  background:#eef2f6;
  border-radius:0 0 20px 20px;
  margin:0 auto;
  position:relative;z-index:10;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.notch-cam{width:10px;height:10px;border-radius:50%;background:#d0d7e2;border:1px solid rgba(255,255,255,0.5)}
.notch-speaker{width:52px;height:5px;border-radius:3px;background:#d0d7e2}

/* status bar – grey */
.statusbar{
  display:flex;justify-content:space-between;align-items:center;
  padding:4px 28px 0;
  font-size:11px;color:var(--muted);
  flex-shrink:0;
}
.sb-time{font-family:'Syne',sans-serif;font-weight:700;font-size:15px;color:var(--text)}
.sb-icons{display:flex;gap:4px;align-items:center}
.sb-icons i { font-size: 12px; color: var(--muted); }

/* scroll content */
.screen{flex:1;overflow-y:auto;padding:0 22px 24px;scrollbar-width:none}
.screen::-webkit-scrollbar{display:none}

/* home header */
.home-header{padding:20px 0 16px;display:flex;justify-content:space-between;align-items:center}
.home-greeting{font-size:12px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:4px}
.home-name{font-family:'Syne',sans-serif;font-size:20px;font-weight:700;color:var(--text)}
.avatar{
  width:40px;height:40px;border-radius:14px;
  background:linear-gradient(135deg,#e2e8f0, #cbd5e1); /* grey gradient */
  display:flex;align-items:center;justify-content:center;font-size:18px;
  color: #1e293b; /* dark grey */
}

/* balance card – light grey */
.balance-card{
  background:linear-gradient(135deg,#f8fafc 0%,#eef2f6 100%);
  border:1px solid rgba(0,0,0,0.04);
  border-radius:24px;padding:28px 24px;margin-bottom:20px;
  position:relative;overflow:hidden;
}
.balance-card::before{
  content:'';position:absolute;top:-40px;right:-40px;
  width:160px;height:160px;border-radius:50%;
  background:radial-gradient(circle,rgba(0,0,0,0.02),transparent);
}
.balance-label{font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px}
.balance-amount{font-family:'Syne',sans-serif;font-size:42px;font-weight:800;color:var(--text);line-height:1;margin-bottom:6px}
.balance-amount span{font-size:22px;color:var(--muted);vertical-align:top;margin-top:6px;display:inline-block}
.balance-sub{font-size:11px;color:var(--muted)}

/* quick actions */
.section-title{font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin:0 0 12px}
.actions{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:24px}
.action-btn{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:14px 8px;
  display:flex;flex-direction:column;align-items:center;gap:6px;
  font-size:10px;color:var(--muted);letter-spacing:0.5px;cursor:pointer;
  transition:border-color 0.2s,background 0.2s;
}
.action-btn:hover{border-color:#a0aec0;background:#e2e8f0;}
.action-icon{font-size:20px; color: var(--text);}
.action-icon i { font-size: 20px; color: var(--text); }

/* transactions */
.tx-list{display:flex;flex-direction:column;gap:8px}
.tx-item{
  background:var(--surface);border:1px solid var(--border);
  border-radius:16px;padding:14px 16px;
  display:flex;align-items:center;gap:12px;
}
.tx-icon{
  width:38px;height:38px;border-radius:12px;
  background:var(--surface2);
  display:flex;align-items:center;justify-content:center;
  font-size:18px;flex-shrink:0;
  color: var(--text);
}
.tx-icon i { font-size: 18px; color: var(--text); }
.tx-info{flex:1}
.tx-name{font-size:13px;color:var(--text);margin-bottom:3px}
.tx-date{font-size:11px;color:var(--muted)}
.tx-amount{font-family:'Syne',sans-serif;font-size:14px;font-weight:700}
.tx-amount.out{color:var(--red)}
.tx-amount.in{color:var(--green)}  /* kept subtle but can be grey */

/* bottom nav */
.bottom-nav{
  display:flex;justify-content:space-around;align-items:center;
  padding:12px 0 28px;
  border-top:1px solid var(--border);
  background:var(--phone-bg);
  flex-shrink:0;
}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:4px;font-size:9px;color:var(--muted);letter-spacing:1px;cursor:pointer;transition:color 0.2s}
.nav-item.active{color:var(--text); font-weight: 500;}
.nav-icon{font-size:20px;}
.nav-icon i { font-size: 20px; color: currentColor; }

/* ════════════════════════════════════════
   PAYMENT POPUP – white/grey reinterpretation
   ════════════════════════════════════════ */
.popup-overlay{
  position:absolute;inset:0;
  background:rgba(255,255,255,0.7);
  backdrop-filter:blur(12px);
  z-index:100;
  display:none;align-items:flex-end;justify-content:center;
  border-radius:54px;
}
.popup-overlay.show{display:flex;animation:overlayIn 0.3s ease both}
@keyframes overlayIn{from{opacity:0}to{opacity:1}}

.popup-sheet{
  width:100%;
  background:var(--white);
  border-radius:28px 28px 0 0;
  padding:0 24px 40px;
  border-top:1px solid rgba(0,0,0,0.04);
  animation:sheetUp 0.45s cubic-bezier(0.16,1,0.3,1) both;
}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:none}}

.sheet-handle{width:40px;height:4px;border-radius:2px;background:rgba(0,0,0,0.1);margin:14px auto 24px}

.popup-merchant{display:flex;align-items:center;gap:14px;margin-bottom:24px}
.popup-merchant-icon{
  width:52px;height:52px;border-radius:16px;
  background:linear-gradient(135deg,#e2e8f0, #cbd5e1);
  display:flex;align-items:center;justify-content:center;
  font-size:24px;box-shadow:0 0 0px rgba(0,0,0,0.05);
  color: #1e293b;
}
.popup-merchant-icon i { font-size: 24px; color: #1e293b; }
.popup-merchant-name{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;margin-bottom:3px;color:var(--text)}
.popup-merchant-sub{font-size:11px;color:var(--muted);letter-spacing:1px}

.popup-amount-label{font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px;text-align:center}
.popup-amount{font-family:'Syne',sans-serif;font-size:56px;font-weight:800;color:var(--text);text-align:center;line-height:1;margin-bottom:6px}
.popup-amount span{font-size:28px;color:var(--muted);vertical-align:top;margin-top:10px;display:inline-block}
.popup-desc{font-size:12px;color:var(--muted);text-align:center;margin-bottom:28px}

.popup-balance-check{
  background:var(--surface2);border:1px solid var(--border);border-radius:14px;
  padding:14px 16px;display:flex;justify-content:space-between;
  font-size:12px;margin-bottom:24px;
}
.pbc-label{color:var(--muted)}
.pbc-val{color:var(--text);font-weight:500}

/* biometric visual – grey */
.palm-visual{
  display:flex;flex-direction:column;align-items:center;gap:12px;
  margin-bottom:28px;
}
.palm-ring{
  width:72px;height:72px;border-radius:50%;
  border:2px solid #9aa4b8;
  display:flex;align-items:center;justify-content:center;
  font-size:34px;position:relative;
  box-shadow:0 0 10px rgba(0,0,0,0.05);
  color: #1e293b;
}
.palm-ring i { font-size: 34px; color: #1e293b; }
.palm-ring::before{
  content:'';position:absolute;inset:-6px;border-radius:50%;
  border:1px solid rgba(0,0,0,0.1);
  animation:ringPulse 2s ease infinite;
}
@keyframes ringPulse{0%,100%{transform:scale(1);opacity:0.5}50%{transform:scale(1.1);opacity:0.1}}
.palm-hint{font-size:11px;color:#5f6b7f;letter-spacing:1.5px;text-transform:uppercase}

/* action buttons – grey/white */
.popup-actions{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.popup-yes{
  height:52px;border:none;border-radius:14px;
  background:#2d3a4f;  /* dark grey */
  color:#ffffff;
  font-family:'Syne',sans-serif;font-size:15px;font-weight:800;
  cursor:pointer;letter-spacing:1px;
  transition:transform 0.15s,box-shadow 0.15s;
  box-shadow:0 4px 12px rgba(0,0,0,0.1);
}
.popup-yes:hover{transform:translateY(-2px);background:#1e293b;}
.popup-no{
  height:52px;border:1px solid #cbd5e1;border-radius:14px;
  background:transparent;color:#64748b;
  font-family:'Syne',sans-serif;font-size:15px;font-weight:700;
  cursor:pointer;letter-spacing:1px;transition:border-color 0.2s,color 0.2s;
}
.popup-no:hover{border-color:#94a3b8;color:#334155;}

/* success state – white/grey */
.popup-success{
  display:none;flex-direction:column;align-items:center;
  padding:20px 0 10px;text-align:center;
}
.popup-success.show{display:flex}
.success-ring{
  width:80px;height:80px;border-radius:50%;
  background:#f1f5f9;border:2px solid #9aa4b8;
  display:flex;align-items:center;justify-content:center;font-size:36px;
  margin-bottom:16px;
  animation:popIn 0.4s cubic-bezier(0.16,1,0.3,1);
  box-shadow:0 0 20px rgba(0,0,0,0.05);
  color: #1e293b;
}
.success-ring i { font-size: 36px; color: #1e293b; }
@keyframes popIn{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}
.success-title{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:#1e293b;margin-bottom:6px}
.success-sub{font-size:12px;color:#64748b;line-height:1.7}
.success-close{
  margin-top:20px;padding:10px 28px;border-radius:10px;
  border:1px solid #cbd5e1;background:transparent;
  color:#475569;font-family:'IBM Plex Mono',monospace;font-size:12px;
  cursor:pointer;letter-spacing:1px;transition:all 0.2s;
}
.success-close:hover{border-color:#64748b;color:#1e293b}

/* animations */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
.screen > *{animation:fadeUp 0.5s ease both}
.home-header{animation-delay:0.05s}
.balance-card{animation-delay:0.1s}
.actions{animation-delay:0.15s}
.tx-list{animation-delay:0.2s}
</style>
</head>
<body>
<div class="phone">
  <div class="notch">
    <div class="notch-cam"></div>
    <div class="notch-speaker"></div>
  </div>

  <!-- Status bar with font awesome icons (grey) -->
  <div class="statusbar">
    <span class="sb-time" id="clock">9:41</span>
    <div class="sb-icons">
      <i class="fas fa-signal"></i>
      <i class="fas fa-battery-full"></i>
    </div>
  </div>

  <!-- Home screen -->
  <div class="screen">
    <div class="home-header">
      <div>
        <div class="home-greeting">Good morning</div>
        <div class="home-name">Ahmed <i class="fas fa-hand-peace" style="font-size: 20px; color: var(--text); margin-left: 4px;"></i></div>
      </div>
      <div class="avatar">
        <i class="fas fa-hand-peace"></i>
      </div>
    </div>

    <!-- Balance -->
    <div class="balance-card">
      <div class="balance-label">Palm Wallet Balance</div>
      <div class="balance-amount" id="balanceDisplay"><span>$</span><span id="balanceNum">1,500.00</span></div>
      <div class="balance-sub">Account · PALM-001</div>
    </div>

    <!-- Quick actions – all icons replaced -->
    <div class="section-title">Quick Actions</div>
    <div class="actions">
      <div class="action-btn"><span class="action-icon"><i class="fas fa-paper-plane"></i></span>Send</div>
      <div class="action-btn"><span class="action-icon"><i class="fas fa-inbox"></i></span>Receive</div>
      <div class="action-btn"><span class="action-icon"><i class="fas fa-clock-rotate-left"></i></span>History</div>
      <div class="action-btn"><span class="action-icon"><i class="fas fa-gear"></i></span>Settings</div>
    </div>

    <!-- Transactions – icons now font awesome -->
    <div class="section-title">Recent Transactions</div>
    <div class="tx-list" id="txList">
      <div class="tx-item">
        <div class="tx-icon"><i class="fas fa-cart-shopping"></i></div>
        <div class="tx-info">
          <div class="tx-name">PalmMart</div>
          <div class="tx-date">Today, 08:32</div>
        </div>
        <div class="tx-amount out">-$45.99</div>
      </div>
      <div class="tx-item">
        <div class="tx-icon"><i class="fas fa-circle-dollar-to-slot"></i></div>
        <div class="tx-info">
          <div class="tx-name">Top Up</div>
          <div class="tx-date">Yesterday</div>
        </div>
        <div class="tx-amount in">+$500.00</div>
      </div>
      <div class="tx-item">
        <div class="tx-icon"><i class="fas fa-mug-saucer"></i></div>
        <div class="tx-info">
          <div class="tx-name">PalmCafe</div>
          <div class="tx-date">Yesterday</div>
        </div>
        <div class="tx-amount out">-$11.03</div>
      </div>
    </div>
  </div>

  <!-- Bottom nav – all icons font awesome -->
  <div class="bottom-nav">
    <div class="nav-item active"><span class="nav-icon"><i class="fas fa-house"></i></span>Home</div>
    <div class="nav-item"><span class="nav-icon"><i class="fas fa-hand-peace"></i></span>Palm</div>
    <div class="nav-item"><span class="nav-icon"><i class="fas fa-chart-simple"></i></span>Stats</div>
    <div class="nav-item"><span class="nav-icon"><i class="fas fa-user"></i></span>Profile</div>
  </div>

  <!-- Payment Popup – icons updated, white/grey theme -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup-sheet">
      <div class="sheet-handle"></div>

      <!-- Default: confirm view -->
      <div id="confirmView">
        <div class="popup-merchant">
          <div class="popup-merchant-icon"><i class="fas fa-mug-saucer"></i></div>
          <div>
            <div class="popup-merchant-name" id="popupMerchantName">PalmCafe</div>
            <div class="popup-merchant-sub">Verified Merchant</div>
          </div>
        </div>

        <div class="popup-amount-label">Payment Request</div>
        <div class="popup-amount"><span>$</span><span id="popupAmount">11.03</span></div>
        <div class="popup-desc" id="popupDesc">Latte ×1 · Croissant ×2 · Tax</div>

        <div class="popup-balance-check">
          <span class="pbc-label">Your balance</span>
          <span class="pbc-val" id="popupBalance">$1,500.00</span>
        </div>

        <div class="palm-visual">
          <div class="palm-ring"><i class="fas fa-hand-peace"></i></div>
          <div class="palm-hint">Palm Verified</div>
        </div>

        <div class="popup-actions">
          <button class="popup-yes" onclick="approvePayment()">CONFIRM</button>
          <button class="popup-no" onclick="rejectPayment()">DECLINE</button>
        </div>
      </div>

      <!-- Success view -->
      <div class="popup-success" id="successView">
        <div class="success-ring"><i class="fas fa-circle-check"></i></div>
        <div class="success-title">Payment Done!</div>
        <div class="success-sub" id="successMsg">$11.03 paid to PalmCafe<br/>Balance updated</div>
        <button class="success-close" onclick="closePopup()">Done</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ══════════════════════════════════════════
//  CONFIG — same functionality, icons adapted
// ══════════════════════════════════════════
const SUPABASE_URL  = 'https://dslrfdvexnafbdnwagvm.supabase.co';
const SUPABASE_ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzbHJmZHZleG5hZmJkbndhZ3ZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwNzMwMjgsImV4cCI6MjA4NzY0OTAyOH0.zQBwJtheqVpYkgMQdovGJh80DMtreR82SsVKFF46dVU';
const USER_ID       = 'e917d2d3-6db3-49c4-8da1-8cc5f25e87f4';

const { createClient } = supabase;
const db = createClient(SUPABASE_URL, SUPABASE_ANON);

let currentRequest = null;
let balance = 1500.00;

function updateClock(){
  const now = new Date();
  document.getElementById('clock').textContent =
    now.getHours().toString().padStart(2,'0') + ':' +
    now.getMinutes().toString().padStart(2,'0');
}
updateClock(); setInterval(updateClock,10000);

async function loadBalance(){
  const { data } = await db.from('users').select('balance,name').eq('id',USER_ID).single();
  if(data){
    balance = parseFloat(data.balance);
    document.getElementById('balanceNum').textContent = balance.toLocaleString('en-US',{minimumFractionDigits:2});
  }
}
loadBalance();

function startListening(){
  db.channel('incoming-payments')
    .on('postgres_changes',{
      event:'INSERT',schema:'public',table:'payment_requests',
      filter:`user_id=eq.${USER_ID}`
    }, async (payload)=>{
      const req = payload.new;
      if(req.status !== 'pending') return;
      console.log('[APP] Incoming request:', req.id, 'amount:', req.amount);

      const { data: merchant } = await db.from('merchants').select('name,icon,order_description').eq('id',req.merchant_id).single();

      currentRequest = req;
      showPopup(req, merchant);
    })
    .subscribe(s => console.log('[APP] Realtime status:', s));
}
startListening();

function showPopup(req, merchant){
  document.getElementById('popupMerchantName').textContent = merchant?.name || 'Merchant';
  document.getElementById('popupAmount').textContent = parseFloat(req.amount).toFixed(2);
  document.getElementById('popupDesc').textContent = merchant?.order_description || 'Payment request';
  document.getElementById('popupBalance').textContent = '$' + balance.toLocaleString('en-US',{minimumFractionDigits:2});

  document.getElementById('confirmView').style.display = 'block';
  document.getElementById('successView').classList.remove('show');
  document.getElementById('popupOverlay').classList.add('show');
}

async function approvePayment(){
  if(!currentRequest) return;

  const { data, error } = await db.rpc('process_payment',{
    p_request_id: currentRequest.id,
    p_user_id:    USER_ID,
    p_amount:     currentRequest.amount
  });

  if(error || !data?.success){
    alert('Payment failed: ' + (data?.error || error?.message));
    return;
  }

  balance = balance - parseFloat(currentRequest.amount);
  document.getElementById('balanceNum').textContent = balance.toLocaleString('en-US',{minimumFractionDigits:2});
  document.getElementById('popupBalance').textContent = '$' + balance.toLocaleString('en-US',{minimumFractionDigits:2});

  addTransaction(currentRequest);

  document.getElementById('confirmView').style.display = 'none';
  const sv = document.getElementById('successView');
  sv.classList.add('show');
  document.getElementById('successMsg').textContent =
    `$${parseFloat(currentRequest.amount).toFixed(2)} paid\nBalance updated`;
}

async function rejectPayment(){
  if(!currentRequest) return;
  await db.from('payment_requests').update({status:'rejected'}).eq('id', currentRequest.id);
  closePopup();
}

function closePopup(){
  document.getElementById('popupOverlay').classList.remove('show');
  currentRequest = null;
}

// Updated to use Font Awesome icon
function addTransaction(req){
  const list = document.getElementById('txList');
  const item = document.createElement('div');
  item.className = 'tx-item';
  item.style.animation = 'fadeUp 0.4s ease both';
  item.innerHTML = `
    <div class="tx-icon"><i class="fas fa-mug-saucer"></i></div>
    <div class="tx-info">
      <div class="tx-name">PalmCafe</div>
      <div class="tx-date">Just now</div>
    </div>
    <div class="tx-amount out">-$${parseFloat(req.amount).toFixed(2)}</div>
  `;
  list.insertBefore(item, list.firstChild);
}
</script>
</body>
</html>